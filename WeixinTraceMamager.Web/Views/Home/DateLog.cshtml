@model WeixinTraceMamager.Web.Models.Home_DateLogVD

@{
    ViewBag.Title = "DataLog";
    var exceptionCount = Model.WeixinTraceItemList.Count(z => z.IsException);
}

<style>
    .detail_result {
        display: none;
        background: #d8d8d8;
        padding: 8px;
    }

    table td {
        word-break: break-all;
    }

    .exception {
        background: #fcc2c2;
    }

    .exceptionCount {
        color: red;
        font-weight: bold;
    }
</style>

@section scripts{
    <script>
        $(function () {
            $('[id^=more_]').click(function () {
                $(this).hide();
                $('#detail_' + $(this).attr('data-i')).slideDown();
            })
        })

        function showAllDetails() {
            $('[id^=detail_').slideDown();
        }

        function showExceptions() {
            $('tr.exception').toggle();
        }
    </script>
}


<h2>日志 - @Model.Date</h2>
<p>
    @Html.ActionLink("<返回", "Index", null, new { @class = "btn btn-default" })
    <a href="javascript:;" onclick="showAllDetails()" class="btn btn-success">显示所有完整结果</a>
    <a href="javascript:;" onclick="showExceptions()" class="btn btn-danger">显示所有异常信息</a>
    异常信息：<span class="@(exceptionCount >0 ? "exceptionCount" : "")">@exceptionCount</span> 条
</p>


<table class="table">
    <tr>
        <th width="100px">编号/行号</th>
        <th width="120px">标题</th>
        <th width="120px">时间</th>
        <th width="50px">线程</th>
        <th width="100px">类型</th>
        <th width="80px;">是否异常</th>
        <th>内容</th>
    </tr>
    @{var i = 0;}
    @foreach (var item in Model.WeixinTraceItemList)
    {
        var showMessage = false;//是否有特殊消息输出
        <tr class="@(item.IsException?"exception":"")">
            <td>
                <strong>#@(++i)</strong> / @item.Line
            </td>
            <td>@item.Title</td>
            <td>@item.DateTime</td>
            <td>@item.ThreadId</td>
            <td>@item.weixinTraceType</td>
            <td>@item.IsException</td>
            <td>
                @if (!string.IsNullOrEmpty(item.Result.Url))
                {
                    showMessage = true;
                    <p>
                        <strong>URL：</strong>
                        @item.Result.Url
                    </p>
                }

                @if (!string.IsNullOrEmpty(item.Result.Result))
                {
                    showMessage = true;
                    <p>
                        <strong>返回结果：</strong>
                        @item.Result.Result
                    </p>
                }
              

                @if (item.IsException)
                {
                    showMessage = true;
                    <p>
                        <strong>异常信息：</strong>
                        @item.Result.ExceptionMessage
                    </p>
                }

                @if (!showMessage)
                {
                    @Html.Raw(item.Result.ToString())//显示所有结果
                }
            </td>
        </tr>

        if (showMessage)
        {
            <tr class="@(item.IsException?"exception":"")">
                <td colspan="7">
                    <a href="javascript:;" id="more_@i" data-i="@i"><strong>#@i</strong> 点击查看完整结果</a>

                    <p id="detail_@i" class="detail_result">
                        @Html.Raw(item.Result.ToString())//显示所有结果
                    </p>

                </td>
            </tr>
        }
    }

</table>
